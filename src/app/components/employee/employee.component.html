<div class="container mt-4">

  <!-- MATERIAL TOOLBAR -->
  <mat-toolbar color="primary" class="mb-4">
    <span>EMPLOYEE MANAGEMENT</span>
    <span class="spacer"></span>

    <!-- FIXED BUTTON -->
    <button mat-icon-button matTooltip="Add New Employee" (click)="openAddDialog()">
      <mat-icon>person_add</mat-icon>
    </button>
  </mat-toolbar>

  <!-- ====================================================== -->
  <!-- ⭐ ALL DIALOGS (KEEP THESE) ⭐ -->
  <!-- ====================================================== -->

  <!-- ========================= -->
  <!-- ⭐ ADD EMPLOYEE DIALOG ⭐ -->
  <!-- ========================= -->
  <ng-template #addDialog>
    <h2 mat-dialog-title>Add Employee</h2>

    <mat-dialog-content>
      <form [formGroup]="empForm">
        <mat-tab-group>
          
          <!-- PERSONAL TAB -->
          <mat-tab label="Personal Details">
            <mat-form-field appearance="fill" class="w-100 mt-3">
              <mat-label>Employee Name</mat-label>
              <input matInput formControlName="eName" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Date of Birth</mat-label>
              <input matInput [matDatepicker]="dobPicker" formControlName="dob" (dateChange)="calculateAge()" />
              <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
              <mat-datepicker #dobPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Age</mat-label>
              <input matInput formControlName="age" readonly />
            </mat-form-field>
          </mat-tab>

          <!-- JOB TAB -->
          <mat-tab label="Job Details">
            <mat-form-field appearance="fill" class="w-100 mt-3">
              <mat-label>Hire Date</mat-label>
              <input matInput [matDatepicker]="hirePicker" formControlName="hireDate" (dateChange)="calculateExperience()" />
              <mat-datepicker-toggle matSuffix [for]="hirePicker"></mat-datepicker-toggle>
              <mat-datepicker #hirePicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Experience</mat-label>
              <input matInput formControlName="experience" readonly />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Gender</mat-label>
              <select matNativeControl formControlName="gender">
                <option value="">Select Gender</option>
                <option value="MALE">Male</option>
                <option value="FEMALE">Female</option>
              </select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Department</mat-label>
              <select matNativeControl formControlName="depName">
                <option value="">Select Department</option>
                <option *ngFor="let dep of departments" [value]="dep.depname">{{ dep.depname }}</option>
              </select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Designation</mat-label>
              <select matNativeControl formControlName="desigName">
                <option value="">Select Designation</option>
                <option *ngFor="let des of designations" [value]="des.desigName">{{ des.desigName }}</option>
              </select>
            </mat-form-field>
          </mat-tab>

        </mat-tab-group>
      </form>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>Cancel</button>
      <button mat-raised-button color="primary" (click)="saveFromDialog()">Add</button>
    </mat-dialog-actions>
  </ng-template>

  <!-- ========================= -->
  <!-- ⭐ EDIT EMPLOYEE DIALOG ⭐ -->
  <!-- ========================= -->
  <ng-template #editDialog let-data="data">
    <h2 mat-dialog-title>Edit Employee</h2>

    <mat-dialog-content>
      <form [formGroup]="empForm">
        <mat-tab-group>

          <mat-tab label="Personal Details">
            <mat-form-field appearance="fill" class="w-100 mt-3">
              <mat-label>Employee Name</mat-label>
              <input matInput formControlName="eName" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Date of Birth</mat-label>
              <input matInput [matDatepicker]="dobPickerEdit" formControlName="dob" (dateChange)="calculateAge()" />
              <mat-datepicker-toggle matSuffix [for]="dobPickerEdit"></mat-datepicker-toggle>
              <mat-datepicker #dobPickerEdit></mat-datepicker>
            </mat-form-field>
          </mat-tab>

          <mat-tab label="Job Details">
            <mat-form-field appearance="fill" class="w-100 mt-3">
              <mat-label>Hire Date</mat-label>
              <input matInput [matDatepicker]="hirePickerEdit" formControlName="hireDate" (dateChange)="calculateExperience()" />
              <mat-datepicker-toggle matSuffix [for]="hirePickerEdit"></mat-datepicker-toggle>
              <mat-datepicker #hirePickerEdit></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Gender</mat-label>
              <select matNativeControl formControlName="gender">
                <option value="MALE">Male</option>
                <option value="FEMALE">Female</option>
              </select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Department</mat-label>
              <select matNativeControl formControlName="depName">
                <option *ngFor="let dep of departments" [value]="dep.depname">{{ dep.depname }}</option>
              </select>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Designation</mat-label>
              <select matNativeControl formControlName="desigName">
                <option *ngFor="let des of designations" [value]="des.desigName">{{ des.desigName }}</option>
              </select>
            </mat-form-field>
          </mat-tab>

        </mat-tab-group>
      </form>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>Cancel</button>
      <button mat-raised-button color="accent" (click)="updateFromDialog(data.id)">Update</button>
    </mat-dialog-actions>
  </ng-template>

  <!-- ================================ -->
  <!-- ⭐ DELETE CONFIRMATION DIALOG ⭐ -->
  <!-- ================================ -->
  <ng-template #deleteDialog let-data>
    <h2 mat-dialog-title>Delete Employee?</h2>

    <mat-dialog-content>Are you sure you want to delete this employee?</mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>No</button>
      <button mat-raised-button color="warn" [mat-dialog-close]="data.id">Delete</button>
    </mat-dialog-actions>
  </ng-template>


  <!-- ====================================================== -->
  <!-- ⭐ ACCORDION SECTION (REAL-WORLD LAYOUT)              -->
  <!-- ====================================================== -->
  <mat-accordion multi>

    <!-- 1️⃣ FORM -->
    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>Add / Update Employee</mat-panel-title>
      </mat-expansion-panel-header>

      <form [formGroup]="empForm" class="card p-4 shadow-sm mb-4">

  <div class="row g-4">

    <!-- Employee Name -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Employee Name</mat-label>
        <input matInput formControlName="eName">
      </mat-form-field>
    </div>

    <!-- Email -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email">
      </mat-form-field>
    </div>

    <!-- Date of Birth -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Date of Birth</mat-label>
        <input matInput [matDatepicker]="dobPickerMain"
               formControlName="dob" 
               (dateChange)="calculateAge()">
        <mat-datepicker-toggle matSuffix [for]="dobPickerMain"></mat-datepicker-toggle>
        <mat-datepicker #dobPickerMain></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Age -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Age</mat-label>
        <input matInput formControlName="age" readonly>
      </mat-form-field>
    </div>

    <!-- Hire Date -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Hire Date</mat-label>
        <input matInput [matDatepicker]="hirePickerMain"
               formControlName="hireDate" 
               (dateChange)="calculateExperience()">
        <mat-datepicker-toggle matSuffix [for]="hirePickerMain"></mat-datepicker-toggle>
        <mat-datepicker #hirePickerMain></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Experience -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Experience</mat-label>
        <input matInput formControlName="experience" readonly>
      </mat-form-field>
    </div>

    <!-- Gender -->
    <div class="col-md-6">
      <label class="fw-bold mb-1">Gender</label>
      <div class="d-flex gap-4 mt-2">
        <mat-radio-group formControlName="gender" class="d-flex gap-4">
          <mat-radio-button value="MALE">Male</mat-radio-button>
          <mat-radio-button value="FEMALE">Female</mat-radio-button>
        </mat-radio-group>
      </div>
    </div>

    <!-- Department -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Department</mat-label>
        <mat-select formControlName="depName">
          <mat-option value="">Select</mat-option>
          <mat-option *ngFor="let dep of departments" [value]="dep.depname">
            {{ dep.depname }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Designation -->
    <div class="col-md-6">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Designation</mat-label>
        <mat-select formControlName="desigName">
          <mat-option value="">Select</mat-option>
          <mat-option *ngFor="let des of designations" [value]="des.desigName">
            {{ des.desigName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

  </div>

  <!-- BUTTONS -->
  <div class="d-flex justify-content-start mt-3 gap-3">
    <button mat-raised-button color="primary" [disabled]="empForm.invalid">
      {{ editMode ? 'Update' : 'Add' }}
    </button>
    <button mat-stroked-button color="warn" (click)="resetForm()">Reset</button>
  </div>

</form>
    </mat-expansion-panel>




    <!-- 2️⃣ SEARCH -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Search Employees</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="input-group mb-3">
        <input type="text" [(ngModel)]="searchTerm" placeholder="Enter name" class="form-control" />
        <button class="btn btn-primary" (click)="searchEmployee()">Search</button>
        <button class="btn btn-secondary" (click)="clearSearch()">Clear</button>
      </div>
    </mat-expansion-panel>




    <!-- 3️⃣ EMPLOYEE TABLE -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Employee List</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="table-responsive shadow-sm w-100 overflow-auto">
        <table class="table table-bordered table-striped mb-0">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th (click)="sortByName()">Name</th>
              <th>Email</th>
              <th>Age</th>
              <th>Experience</th>
              <th>Gender</th>
              <th>Department</th>
              <th>Designation</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <ng-container *ngFor="let emp of paginatedEmployees">
              <tr>
              <td>{{ emp.eId }}</td>
              <td>{{ emp.eName }}</td>
              <td>{{ emp.email }}</td>
              <td>{{ emp.age }}</td>
              <td>{{ emp.experience }}</td>
              <td>{{ emp.gender }}</td>
              <td>{{ emp.departmentName }}</td>
              <td>{{ emp.designationName }}</td>
              <td>
                <button class="btn btn-primary btn-sm me-2" (click)="openEditDialog(emp)">Edit</button>
                <button class="btn btn-danger btn-sm" (click)="openDeleteDialog(emp.eId)">Delete</button>
              </td>
            </tr>
            </ng-container>
          </tbody>
        </table>
      </div>

      <!-- NO DATA -->
      <div *ngIf="filteredEmployees.length === 0" class="alert alert-warning mt-3">No employees found.</div>

      <!-- PAGINATION -->
      <div *ngIf="filteredEmployees.length > 0" class="mt-3 text-center">
        <button class="btn btn-outline-secondary" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
          Prev
        </button>

        <button
          *ngFor="let page of pageNumbers"
          class="btn"
          [class.btn-primary]="currentPage === page"
          [class.btn-outline-primary]="currentPage !== page"
          (click)="changePage(page)">
          {{ page }}
        </button>

        <button class="btn btn-outline-secondary" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
          Next
        </button>
      </div>

    </mat-expansion-panel>

  </mat-accordion>

</div>
